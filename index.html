<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Pedido</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8fafc;
    }
    .table-header {
      background-color: #1e1b4b;
      color: white;
    }
    .table-row:hover {
      background-color: #eef2ff;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">
  <div class="w-full max-w-6xl bg-white p-6 rounded-2xl shadow-lg">
    <h1 class="text-3xl font-bold text-center mb-6">üìã Registro de Pedido</h1>

    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
      <div>
        <label class="font-semibold text-gray-700">Nombre:</label>
        <input id="nombreCliente" type="text" class="border border-gray-300 rounded-lg p-2 w-64 focus:ring focus:ring-indigo-200" placeholder="Ingrese su nombre" />
      </div>
      <div class="flex gap-3">
        <input id="buscarProducto" type="text" class="border border-gray-300 rounded-lg p-2" placeholder="Buscar producto..." />
        <select id="filtroCategoria" class="border border-gray-300 rounded-lg p-2">
          <option value="">Todas las categor√≠as</option>
        </select>
      </div>
    </div>

    <table class="w-full border border-gray-300 rounded-lg overflow-hidden text-sm">
      <thead class="table-header">
        <tr>
          <th class="py-2 px-3 text-left">ID</th>
          <th class="py-2 px-3 text-left">Nombre</th>
          <th class="py-2 px-3 text-left">Categor√≠a</th>
          <th class="py-2 px-3 text-center">Stock</th>
          <th class="py-2 px-3 text-center">Cantidad</th>
          <th class="py-2 px-3 text-center">Acci√≥n</th>
        </tr>
      </thead>
      <tbody id="tablaProductos" class="bg-white divide-y divide-gray-200"></tbody>
    </table>

    <div class="mt-10 bg-gray-50 p-6 rounded-2xl shadow-inner">
      <h2 class="text-xl font-bold mb-4 flex items-center">
        üßæ Resumen del Pedido
      </h2>
      <input id="nombrePedido" type="text" class="border border-gray-300 rounded-lg p-2 mb-4 w-64" placeholder="Nombre del pedido" />

      <table class="w-full border border-gray-300 rounded-lg overflow-hidden text-sm mb-4">
        <thead class="table-header">
          <tr>
            <th class="py-2 px-3 text-left">Producto</th>
            <th class="py-2 px-3 text-center">Cantidad</th>
            <th class="py-2 px-3 text-center">Acci√≥n</th>
          </tr>
        </thead>
        <tbody id="tablaPedido" class="bg-white divide-y divide-gray-200"></tbody>
      </table>

      <button id="enviarPedido" class="w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-3 rounded-xl transition">
        Confirmar y Enviar Pedido
      </button>
    </div>
  </div>

  <script>
    const productos = [
      { id: "00PROMO", nombre: "PROMOCION X KILO TELAS VARIAS", categoria: "PROMOCION", stock: 7 },
      { id: "02PROM", nombre: "PROMOCION 9000", categoria: "PROMOCION", stock: 25 },
      { id: "03PROM", nombre: "PROMOCION 5500", categoria: "PROMOCION", stock: 150 },
      { id: "04PROM", nombre: "PROMOCION 11000", categoria: "PROMOCION", stock: 80 },
      { id: "2000100600001", nombre: "CAMISETA PRO BLANCO C#24", categoria: "CAMISETA", stock: 0 },
      { id: "2000100600002", nombre: "CAMISETA PRO NEGRO C#23", categoria: "CAMISETA", stock: 0 },
      { id: "2000100600003", nombre: "CAMISETA PRO ROJO BRILLANTE C#72", categoria: "CAMISETA", stock: 0 },
    ];

    const tablaProductos = document.getElementById("tablaProductos");
    const filtroCategoria = document.getElementById("filtroCategoria");
    const buscarProducto = document.getElementById("buscarProducto");
    const tablaPedido = document.getElementById("tablaPedido");
    const enviarPedido = document.getElementById("enviarPedido");
    const nombreCliente = document.getElementById("nombreCliente");
    const nombrePedido = document.getElementById("nombrePedido");

    let pedido = [];

    function renderCategorias() {
      const categorias = [...new Set(productos.map(p => p.categoria))];
      categorias.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        filtroCategoria.appendChild(opt);
      });
    }

    function renderProductos() {
      const filtro = filtroCategoria.value.toLowerCase();
      const busqueda = buscarProducto.value.toLowerCase();
      tablaProductos.innerHTML = "";

      productos
        .filter(p => 
          (filtro === "" || p.categoria.toLowerCase() === filtro) &&
          (p.nombre.toLowerCase().includes(busqueda) || p.id.toLowerCase().includes(busqueda))
        )
        .forEach(p => {
          const fila = document.createElement("tr");
          fila.classList.add("table-row");
          fila.innerHTML = `
            <td class="py-2 px-3">${p.id}</td>
            <td class="py-2 px-3">${p.nombre}</td>
            <td class="py-2 px-3">${p.categoria}</td>
            <td class="py-2 px-3 text-center">${p.stock}</td>
            <td class="py-2 px-3 text-center">
              <input type="number" id="cant-${p.id}" class="border border-gray-300 rounded-lg w-16 text-center" min="0" value="0" />
            </td>
            <td class="py-2 px-3 text-center">
              <button class="bg-indigo-700 hover:bg-indigo-800 text-white py-1 px-3 rounded-lg" onclick="agregarPedido('${p.id}')">Agregar</button>
            </td>
          `;
          tablaProductos.appendChild(fila);
        });
    }

    function agregarPedido(id) {
      const producto = productos.find(p => p.id === id);
      const cantidad = parseInt(document.getElementById(`cant-${id}`).value);

      if (cantidad > 0) {
        const existente = pedido.find(item => item.id === id);
        if (existente) {
          existente.cantidad += cantidad;
        } else {
          pedido.push({ ...producto, cantidad });
        }
        renderPedido();
      } else {
        alert("‚ö†Ô∏è Ingrese una cantidad v√°lida");
      }
    }

    function eliminarPedido(id) {
      pedido = pedido.filter(p => p.id !== id);
      renderPedido();
    }

    function renderPedido() {
      tablaPedido.innerHTML = "";
      pedido.forEach(p => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td class="py-2 px-3">${p.nombre}</td>
          <td class="py-2 px-3 text-center">${p.cantidad}</td>
          <td class="py-2 px-3 text-center">
            <button class="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-lg" onclick="eliminarPedido('${p.id}')">X</button>
          </td>
        `;
        tablaPedido.appendChild(fila);
      });
    }

    async function enviarPedidoReal() {
      if (pedido.length === 0 || !nombreCliente.value) {
        alert("‚ö†Ô∏è Ingrese el nombre del cliente y al menos un producto.");
        return;
      }

      const datos = {
        nombreCliente: nombreCliente.value,
        nombrePedido: nombrePedido.value || "Sin nombre",
        productos: pedido
      };

      try {
        const respuesta = await fetch("https://script.google.com/macros/s/TU_ID_DE_SCRIPT/exec", {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(datos)
        });
        alert("‚úÖ Pedido enviado correctamente.");
        pedido = [];
        renderPedido();
      } catch (error) {
        alert("‚ùå Hubo un error al enviar el pedido.");
        console.error(error);
      }
    }

    filtroCategoria.addEventListener("change", renderProductos);
    buscarProducto.addEventListener("input", renderProductos);
    enviarPedido.addEventListener("click", enviarPedidoReal);

    renderCategorias();
    renderProductos();
  </script>
</body>
</html>

