<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventario de Productos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f5f6fa; }
    .card { background: white; border-radius: 1rem; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    .title-icon { color: #4338CA; }
    .btn-main { background: #16A34A; color: white; font-weight: 600; }
    .btn-main:hover { background: #15803D; }
    .header { background-color: #4338CA; color: white; }
  </style>
</head>

<body class="min-h-screen p-4 md:p-10">
  <div class="max-w-7xl mx-auto space-y-8">
    <!-- T√çTULO -->
    <div class="text-center">
      <h1 class="text-3xl md:text-4xl font-bold flex justify-center items-center gap-2">
        <span class="title-icon">üì¶</span> Inventario de Productos
      </h1>
    </div>

    <!-- FILTROS -->
    <div class="flex flex-col md:flex-row gap-4 justify-center">
      <input id="searchInput" type="text" placeholder="Buscar por nombre..." class="border rounded-lg px-4 py-2 w-full md:w-1/3 focus:ring focus:ring-indigo-200" />
      <select id="categoryFilter" class="border rounded-lg px-4 py-2 w-full md:w-1/4 focus:ring focus:ring-indigo-200">
        <option value="">Todas las categor√≠as</option>
      </select>
    </div>

    <!-- TABLA -->
    <div class="card overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 text-sm text-left">
        <thead class="header text-xs uppercase font-semibold">
          <tr>
            <th class="px-4 py-3">ID</th>
            <th class="px-4 py-3">Nombre</th>
            <th class="px-4 py-3">Categor√≠a</th>
            <th class="px-4 py-3">Stock</th>
            <th class="px-4 py-3">Cantidad</th>
            <th class="px-4 py-3">Acci√≥n</th>
          </tr>
        </thead>
        <tbody id="productTable" class="divide-y divide-gray-100"></tbody>
      </table>
    </div>

    <!-- RESUMEN -->
    <div class="card p-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
        üßæ Resumen del Pedido
      </h2>
      <input id="userName" type="text" placeholder="Escribe tu nombre (requerido para el registro)" class="border rounded-lg w-full px-4 py-2 mb-4 focus:ring focus:ring-indigo-200" />

      <div id="summaryList" class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="header">
            <tr>
              <th class="px-4 py-2">Producto</th>
              <th class="px-4 py-2">Cantidad</th>
              <th class="px-4 py-2">Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="summaryTable" class="divide-y divide-gray-100"></tbody>
        </table>
      </div>

      <button id="submitOrder" class="btn-main w-full py-3 mt-4 rounded-lg">Confirmar y Enviar Pedido</button>
    </div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxZD0Bfb_1R3nVS5bedAUZX6P5qrI5-jF2u3NiCPsYG31WETPGtPWvKYJtHMtRMiuGMwg/exec";
    let allProducts = [];
    let cart = {};

    async function loadProducts() {
      try {
        const response = await fetch(scriptURL);
        const data = await response.json();
        allProducts = data;
        renderProducts(allProducts);
        fillCategories(data);
      } catch (error) {
        console.error("Error al cargar los productos:", error);
      }
    }

    function renderProducts(products) {
      const table = document.getElementById("productTable");
      table.innerHTML = "";
      products.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="px-4 py-2">${p.id}</td>
          <td class="px-4 py-2">${p.nombre}</td>
          <td class="px-4 py-2">${p.categoria || ""}</td>
          <td class="px-4 py-2 text-center">${p.stock || 0}</td>
          <td class="px-4 py-2 text-center"><input type="number" min="0" value="0" class="border rounded px-2 py-1 w-16 text-center" onchange="updateCart('${p.id}', this.value, '${p.nombre}')"></td>
          <td class="px-4 py-2 text-center"><button class="text-indigo-600 hover:underline" onclick="addToCart('${p.id}', '${p.nombre}')">‚ûï Agregar</button></td>
        `;
        table.appendChild(row);
      });
    }

    function fillCategories(data) {
      const categories = [...new Set(data.map(p => p.categoria).filter(Boolean))];
      const select = document.getElementById("categoryFilter");
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
    }

    function filterProducts() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const category = document.getElementById("categoryFilter").value;
      const filtered = allProducts.filter(p =>
        (!category || p.categoria === category) &&
        (!search || p.nombre.toLowerCase().includes(search))
      );
      renderProducts(filtered);
    }

    function updateCart(id, qty, name) {
      qty = parseInt(qty);
      if (qty > 0) cart[id] = { name, qty };
      else delete cart[id];
      renderSummary();
    }

    function addToCart(id, name) {
      if (!cart[id]) cart[id] = { name, qty: 1 };
      else cart[id].qty++;
      renderSummary();
    }

    function renderSummary() {
      const table = document.getElementById("summaryTable");
      table.innerHTML = "";
      Object.entries(cart).forEach(([id, item]) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="px-4 py-2">${item.name}</td>
          <td class="px-4 py-2 text-center">${item.qty}</td>
          <td class="px-4 py-2 text-center">
            <button class="text-red-600 hover:underline" onclick="removeFromCart('${id}')">‚ùå</button>
          </td>
        `;
        table.appendChild(row);
      });
    }

    function removeFromCart(id) {
      delete cart[id];
      renderSummary();
    }

    document.getElementById("searchInput").addEventListener("input", filterProducts);
    document.getElementById("categoryFilter").addEventListener("change", filterProducts);

    document.getElementById("submitOrder").addEventListener("click", () => {
      const name = document.getElementById("userName").value.trim();
      if (!name) return alert("Por favor, escribe tu nombre.");
      if (Object.keys(cart).length === 0) return alert("No has agregado productos.");
      alert("‚úÖ Pedido enviado correctamente (simulado)");
      cart = {};
      renderSummary();
    });

    loadProducts();
  </script>
</body>
</html>

